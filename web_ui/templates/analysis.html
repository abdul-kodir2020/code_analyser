<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyse - {{ analysis.project_name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <h1 class="logo">Code Analyzer</h1>
            <div class="nav-links">
                <a href="/">Nouvelle Analyse</a>
                <a href="/history">Historique</a>
                <a href="/compare">Comparer</a>
            </div>
        </div>
    </nav>
    
    <button id="themeToggle" onclick="toggleTheme()">üåô Mode Sombre</button>

    <main class="container main-content">
        <div class="page-header">
            <h2>{{ analysis.project_name }}</h2>
            <p>{{ analysis.repo_url }}</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Statut</div>
                <div class="stat-value">
                    {% if analysis.status == 'completed' %}
                        <span class="badge badge-success">Termin√©</span>
                    {% elif analysis.status == 'running' %}
                        <span class="badge badge-warning">En cours</span>
                    {% elif analysis.status == 'failed' %}
                        <span class="badge badge-danger">√âchec</span>
                    {% else %}
                        <span class="badge badge-info">En attente</span>
                    {% endif %}
                </div>
            </div>

            {% if analysis.total_modules %}
            <div class="stat-card">
                <div class="stat-label">Modules</div>
                <div class="stat-value">{{ analysis.total_modules }}</div>
            </div>
            {% endif %}

            {% if analysis.total_dependencies %}
            <div class="stat-card">
                <div class="stat-label">D√©pendances</div>
                <div class="stat-value">{{ analysis.total_dependencies }}</div>
            </div>
            {% endif %}

            <div class="stat-card">
                <div class="stat-label">Cr√©√© le</div>
                <div class="stat-value" style="font-size: 1em;">{{ analysis.created_at[:19] }}</div>
            </div>
        </div>

        {% if analysis.status == 'completed' %}
            <div class="card">
                <h3>Rapport d'Analyse</h3>
                <p style="color: #64748b; margin-bottom: 20px;">
                    L'analyse est termin√©e. Consultez le rapport d√©taill√© ou obtenez des suggestions IA interactives.
                </p>
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <a href="/report/{{ analysis.id }}" target="_blank" class="btn btn-primary btn-lg">
                        üìÑ Rapport Complet
                    </a>
                    <a href="/analysis/{{ analysis.id }}/ai-suggestions" class="btn btn-secondary btn-lg">
                        ü§ñ Suggestions IA Interactives
                    </a>
                </div>
            </div>
        {% elif analysis.status == 'running' %}
            <div class="card">
                <div class="loading-state">
                    <div class="spinner-large"></div>
                    <h3>Analyse en cours...</h3>
                    <p>Cette page se rafra√Æchira automatiquement toutes les 5 secondes</p>
                </div>
            </div>
            <script>
                setTimeout(() => location.reload(), 5000);
            </script>
        {% elif analysis.status == 'failed' %}
            <div class="card">
                <div class="alert alert-danger">
                    <h3>L'analyse a √©chou√©</h3>
                    {% if analysis.error_message %}
                        <p><strong>Erreur:</strong> {{ analysis.error_message }}</p>
                    {% endif %}
                    <p style="margin-top: 15px;">
                        <a href="/" class="btn btn-primary">R√©essayer avec un autre projet</a>
                    </p>
                </div>
            </div>
        {% endif %}

        <div class="card">
            <h3>Actions</h3>
            <div class="action-buttons">
                <a href="/history" class="btn btn-secondary">‚Üê Retour √† l'historique</a>
                <button onclick="deleteAnalysis()" class="btn btn-danger">Supprimer cette analyse</button>
            </div>
        </div>
    </main>

    <script>
        async function deleteAnalysis() {
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer cette analyse ?')) {
                return;
            }

            try {
                const response = await fetch('/api/delete-analysis/{{ analysis.id }}', {
                    method: 'DELETE'
                });

                const data = await response.json();

                if (data.success) {
                    window.location.href = '/history';
                }
            } catch (error) {
                alert('Erreur lors de la suppression: ' + error.message);
            }
        }
        
        function toggleTheme() {
            const body = document.body;
            const button = document.getElementById('themeToggle');
            
            body.classList.toggle('dark-theme');
            
            if (body.classList.contains('dark-theme')) {
                button.innerHTML = '‚òÄÔ∏è Mode Clair';
                localStorage.setItem('theme', 'dark');
            } else {
                button.innerHTML = 'üåô Mode Sombre';
                localStorage.setItem('theme', 'light');
            }
        }
        
        // Charger le th√®me sauvegard√©
        window.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme');
            const button = document.getElementById('themeToggle');
            
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-theme');
                button.innerHTML = '‚òÄÔ∏è Mode Clair';
            }
        });
    </script>
</body>
</html>
